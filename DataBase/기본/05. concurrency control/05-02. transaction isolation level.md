## 이상현상

### dirty read: 커밋되지 않은 값을 읽음

시작: x = 10, y = 20\
끝: x = 80, y = 20

`r1(x = 10)` <u>`w2(y = 70)`</u> `r1(y = 70)` `w1(x = 80)` `c1` <u>`abort2`</u>

> tx2는 y = 70으로 수정 tx1은 x에 y 더함, tx2가 롤백하면서 tx1은 **이상한 값을 읽고 연산을 한게 됨**

### non repeatable read: 같은 데이터의 값이 달라짐

`r1(x = 10)` <u>`r2(x = 10)` `w2(x = 50)` `c2`</u> `r1(x = 50)` `c1`

> tx1이 2번 읽고 tx2는 40을 더한다. tx1에서 **같은 데이터의 값이 달라진다.**

### Phantom Read: 없던 데이터 생성 됨

t1(v = 10), t2(v = 10)

`r1(v = 10) => t1` <u>`w2(t2.v = 10)` `c2`</u> `r1(v = 10) => t1, t2` `c1`

> tx1은 v가 10인 데이터를 두번 읽음 tx2는 t2의 v를 10으로 수정함, tx1은 **없던 데이터가 생김**

## Isolation Level

| Isolation Level  | Dirty Read | Non-repeatable Read | Phantom Read |
| ---------------- | :--------: | :-----------------: | :----------: |
| Read Uncommitted |     ✅      |          ✅          |      ✅       |
| Read Committed   |     ❌      |          ✅          |      ✅       |
| Repeatable Read  |     ❌      |          ❌          |      ✅       |
| Serializable     |     ❌      |          ❌          |      ❌       |

- Serializable은 이상 현상 자체가 발생하지않음
- Isolation Level별로 데이터 일관성과 처리량에서 트레이드가 가능함

### dirty write

시작: x = 0\
끝: x = 10

`w1(x = 10)` <u>`w2(x = 100)`</u> `abort1` <u>`abort2`</u>

tx1은 x = 10으로 tx2는 x = 100으로 바꿈, tx2는 **commit되지 않은 데이터를 write함**

### lost update

시작: x = 50\
끝: x = 100

`r1(x = 50)` <u>`r2(x = 50)` `w2(x = 200)` `c2`</u> `w1(x = 100)` `c1`

tx1은 x += 50, tx2는 x += 150, tx1이 x를 100으로 수정하면서 tx2의 작업은 **업데이트를 덮어 쓴다.**

### dirty read

시작: x = 50, y = 50\
끝: x = 10, y = 90

`r1(x = 50)` `w1(x = 10)` <u>`r2(x = 10)` `r2(y = 50)` `c2`</u> `r1(y = 50)` `w1(y = 90)` `c1`

tx1은 x의 40을 y로 보내고 tx2는 x와 y를 읽는다. tx2에서 읽은 x, y의 합이 60으로 정합성이 깨진다. 즉 **commit되지 않은 변화를 읽는다.**

### read skew

시작: x = 50, y = 50\
끝: x = 10, y = 90

<u>`r2(x = 50)`</u> `r1(x = 50)` `w1(x = 10)` `r1(y = 50)` `w1(y = 90)` `c1` <u>`r2(y = 90)`</u>

tx2에서 읽은 값은 140으로 데이터 정합성 깨짐, **inconsistent한 데이터 읽기**

### write skew

시작: x = 50, y = 50\
끝: x = 10, y = 90\
제약조건: x + y >= 0

`r1(x = 50)` `r1(y = 50)` <u>`r2(x = 50)` `r2(y = 50)`</u> `w1(x = -30)` <u>`w2(y = -40)`</u> `c1` <u>`c2`</u>

tx1은 x에서 80을 뺀다. tx2는 y에서 90을 뺀다. **inconsistent한 데이터 쓰기**

### Phantom Read

시작: t1(... v = 7), cnt = 0

> cnt는 10이상인 v의 수

`r1(v > 10) => .` <u>`w2(insert t2: ... v = 15)` `r2(cnt = 0)` `w2(cnt = 1)` `c2`</u> `r(cnt = 1)` `c1`

tx1은 v > 10 데이터와 cnt을 읽음, tx2는 v = 15인 t2추가 cnt 1 증가, tx1에서 **없던 데이터가 생김**

### snapshot isolation

시작: x = 50, y = 50\
끝: x = 50, y = 150

`r1(x = 50)` `w1(x = 50)` <u>`r2(y = 50)` `w2(y = 150)` `c2`</u> `r1(y = 50)` `w1(y = 90)` `abort1`

tx2에서 y값에 대한 스냅샷이 생성된 후 커밋되면 적용된다. tx1은 스냅샷의 y값이 달라 먼저 커밋한 tx1만 적용된다.
