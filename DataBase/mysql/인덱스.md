## DB 성능 개선 방법

1. SQL 튜닝
2. 캐싱(e.g. redis)
3. 마스터/슬레이브
4. 샤딩
5. 스케일 업

SQL 튜닝은 DB에서 최적화하는 방법으로 다른 시스템 구성 없이 성능 개선이 가능해 첫번째로 확인해야 한다.

MySQL의 옵티마이저가 세운 SQL문 실행 계획은 종종 틀릴 수 있어서 개발자가 튜닝 해야 한다.

성능 문제는 데이터 조회에서 발생한다. SQL 튜닝의 핵심은 빠른 데이터 참조와 최소 데이터 조회다.

### EXPLAIN 주요 컬럼 설명

| 컬럼            | 설명                                                                               |
| --------------- | ---------------------------------------------------------------------------------- |
| `type`          | **조회 방식**을 나타냅니다. (아래 `type` 상세 설명 참고)                           |
| `possible_keys` | MySQL이 쿼리를 실행할 때 **사용할 수 있었던 인덱스 목록**입니다.                   |
| `key`           | `possible_keys` 중에서 **실제로 사용된 인덱스**를 의미합니다.                      |
| `ref`           | 조인(JOIN) 시 어떤 값을 기준으로 조인하는지 표시합니다. (예: 컬럼명, 상수)         |
| `rows`          | 쿼리 실행을 위해 테이블에 **접근해야 할 것으로 예상되는 행의 수**입니다.           |
| `filtered`      | 테이블에서 읽은 행 중에서 조건에 의해 **필터링되고 남은 행의 예상 비율**(%)입니다. |

### explain analyze

```txt
-> Filter: (u.name = 'John Doe')  (cost=0.35 rows=1) (actual time=0.041..0.048 rows=1 loops=1)
    -> Table scan on u  (cost=0.35 rows=1) (actual time=0.030..0.035 rows=1 loops=1)
        -> Index lookup on o using user_id (user_id=u.id)  (cost=0.85 rows=1) (actual time=0.071..0.089 rows=2 loops=1)
```

Table scan: full table scan
Index lookup: 인덱스 스캔
actualtime(... ..시간1): 스캔에 걸린 시간(ms)

> Filter에서 필터링에 걸린 시간(0.013) = Filter 총 시간(0.048) - Table scan 총 시간(0.035)

rows: 접근한 데이터 수

### `type` 컬럼의 주요 값과 설명

| Type    | 설명                                                                                                | 성능      |
| ------- | --------------------------------------------------------------------------------------------------- | --------- |
| `const` | **가장 빠름.** `PRIMARY KEY`나 `UNIQUE` 인덱스 조건으로 단 **한 건**의 데이터를 조회합니다.         | 최상      |
| `ref`   | `const`와 달리 고유하지 않은(non-unique) 인덱스를 사용하여 **여러 건의 데이터를 조회**합니다.       | 좋음      |
| `range` | 인덱스를 사용하여 특정 **범위**의 데이터를 조회합니다. (예: `BETWEEN`, `>`, `<`)                    | 보통      |
| `index` | 인덱스 전체를 스캔합니다. 테이블 전체를 스캔하는 `all`보다는 빠릅니다.                              | 나쁨      |
| `all`   | **가장 느림.** 테이블 전체를 스캔(Full Table Scan)합니다. 인덱스를 전혀 사용하지 못하는 경우입니다. | 매우 나쁨 |
